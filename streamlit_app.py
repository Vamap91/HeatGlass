# Corrigindo erro de string quebrada no c√≥digo da linha 100
codigo_corrigido = [
    "import streamlit as st",
    "from openai import OpenAI",
    "import tempfile",
    "import re",
    "",
    "st.set_page_config(page_title=\"HeatGlass\", page_icon=\"üî¥\", layout=\"centered\")",
    "",
    "st.markdown(\"\"\"",
    "<style>",
    "h1, h2, h3 { color: #C10000 !important; }",
    ".result-box { background-color: #ffecec; padding: 1em; border-left: 5px solid #C10000; border-radius: 6px; font-size: 1rem; white-space: pre-wrap; line-height: 1.5; }",
    ".stButton>button { background-color: #C10000; color: white; font-weight: 500; border-radius: 6px; padding: 0.4em 1em; border: none; }",
    "</style>",
    "\"\"\", unsafe_allow_html=True)",
    "",
    "client = OpenAI(api_key=st.secrets[\"OPENAI_API_KEY\"])",
    "",
    "st.title(\"HeatGlass\")",
    "st.write(\"An√°lise de liga√ß√µes com transcri√ß√£o, impacto comercial, temperatura emocional e checklist t√©cnico.\")",
    "",
    "uploaded_file = st.file_uploader(\"Envie o √°udio da liga√ß√£o (.mp3)\", type=[\"mp3\"])",
    "",
    "if uploaded_file is not None:",
    "    with tempfile.NamedTemporaryFile(delete=False, suffix=\".mp3\") as tmp:",
    "        tmp.write(uploaded_file.read())",
    "        tmp_path = tmp.name",
    "",
    "    st.audio(uploaded_file, format='audio/mp3')",
    "",
    "    with st.spinner(\"Transcrevendo o √°udio...\"):",
    "        with open(tmp_path, \"rb\") as audio_file:",
    "            transcript = client.audio.transcriptions.create(",
    "                model=\"whisper-1\",",
    "                file=audio_file",
    "            )",
    "        transcript_text = transcript.text",
    "",
    "    st.subheader(\"Transcri√ß√£o da Liga√ß√£o\")",
    "    st.code(transcript_text, language=\"markdown\")",
    "",
    "    prompt = f'''",
    "Voc√™ √© um especialista em atendimento ao cliente e auditor de qualidade. Com base na transcri√ß√£o de uma liga√ß√£o, realize duas an√°lises:",
    "",
    "1. An√°lise emocional e comercial:",
    "- Temperatura emocional: Calma, Neutra, Tensa ou Muito Tensa.",
    "- Justifique com base no humor do cliente e na condu√ß√£o do atendente.",
    "- Impacto no neg√≥cio (0 a 100%): Quanto a liga√ß√£o favoreceu a empresa?",
    "",
    "Avalie o impacto no neg√≥cio com base nos crit√©rios abaixo:",
    "‚Ä¢ Se o cliente demonstrou insatisfa√ß√£o, frustra√ß√£o ou amea√ßa de cancelamento ‚Üí o impacto deve ser inferior a 50%.",
    "‚Ä¢ Se o cliente mencionou problemas anteriores com a empresa ‚Üí penalize o percentual.",
    "‚Ä¢ Se o cliente finalizou satisfeito, confiante e com boa expectativa ‚Üí o impacto pode ser maior.",
    "‚Ä¢ S√≥ atribua 100% se houver clareza de satisfa√ß√£o total por parte do cliente ao final da liga√ß√£o.",
    "",
    "- Situa√ß√£o final: O cliente ficou satisfeito? Houve fechamento, cancelamento ou risco?",
    "",
    "2. Avalia√ß√£o t√©cnica do atendimento com base no checklist abaixo. Para cada item, responda \"Sim\" ou \"N√£o\" com justificativa. Some os pontos dos itens marcados como \"Sim\" e exiba ao final:",
    "",
    "Checklist de Qualidade (com pontua√ß√£o):",
    "1. Sauda√ß√£o correta e atendimento imediato ‚Äì 10 pts",
    "2. Confirma√ß√£o do hist√≥rico do cliente ‚Äì 7 pts",
    "3. Confirma√ß√£o dos dados e dois telefones ‚Äì 6 pts",
    "4. Verbaliza√ß√£o do script da LGPD ‚Äì 2 pts",
    "5. T√©cnica do eco para garantir entendimento ‚Äì 5 pts",
    "6. Escuta ativa e aten√ß√£o √† solicita√ß√£o ‚Äì 3 pts",
    "7. Dom√≠nio do servi√ßo ‚Äì 5 pts",
    "8. Consulta ao manual antes de pedir ajuda ‚Äì 2 pts",
    "9. Confirma√ß√£o de dados sobre o dano ‚Äì 10 pts",
    "10. Registro t√©cnico detalhado (LED, Xenon etc) ‚Äì 10 pts",
    "11. Sele√ß√£o correta da loja ‚Äì 10 pts",
    "12. Comunica√ß√£o adequada, sem g√≠rias ‚Äì 5 pts",
    "13. Registro correto e resolu√ß√£o completa ‚Äì 6 pts",
    "14. Script de encerramento completo ‚Äì 15 pts",
    "15. Informa√ß√£o sobre pesquisa de satisfa√ß√£o ‚Äì 6 pts",
    "16. Tabula√ß√£o correta ‚Äì 4 pts",
    "",
    "Apresente o resultado assim:",
    "- Checklist = X pontos de 100",
    "- Itens n√£o atendidos: liste os n√∫meros e sugest√µes de melhoria.",
    "",
    f"Transcri√ß√£o:\\n\"\"\"{transcript_text}\"\"\"",
    "'''",
    "",
    "    with st.spinner(\"Analisando a conversa...\"):",
    "        response = client.chat.completions.create(",
    "            model=\"gpt-4\",",
    "            messages=[{\"role\": \"user\", \"content\": prompt}],",
    "            temperature=0.4",
    "        )",
    "        output = response.choices[0].message.content",
    "",
    "    match_impacto = re.search(r\"Impacto.*?(\\d{1,3})%\", output)",
    "    impacto = int(match_impacto.group(1)) if match_impacto else None",
    "",
    "    match_pontos = re.search(r\"Checklist\\s*=\\s*(\\d{1,3})\\s*pontos\", output, re.IGNORECASE)",
    "    checklist_pontos = int(match_pontos.group(1)) if match_pontos else None",
    "",
    "    if impacto is not None:",
    "        st.subheader(\"Impacto no neg√≥cio\")",
    "        st.progress(impacto / 100)",
    "        if impacto <= 25:",
    "            status = \"üî¥ Cr√≠tico\"",
    "        elif impacto <= 50:",
    "            status = \"üü† Baixo\"",
    "        elif impacto <= 70:",
    "            status = \"üü° Razo√°vel\"",
    "        elif impacto <= 85:",
    "            status = \"üü¢ Positivo\"",
    "        else:",
    "            status = \"üü© Excelente\"",
    "        st.write(f\"Resultado: **{status}** ({impacto}%)\")",
    "",
    "    if checklist_pontos is not None:",
    "        st.subheader(\"Check List T√©cnico\")",
    "        st.write(f\"Resultado: **{checklist_pontos} pontos de 100**\")",
    "",
    "    st.subheader(\"An√°lise da Liga√ß√£o\")",
    "    st.markdown(f\"<div class='result-box'>{output}</div>\", unsafe_allow_html=True)"
]

# Salvar o novo .py
path_corrigido = "/mnt/data/streamlit_app.py"
with open(path_corrigido, "w") as f:
    for linha in codigo_corrigido:
        f.write(linha + "\n")

path_corrigido
